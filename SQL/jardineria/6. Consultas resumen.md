# 📊 Consultas SQL de Resumen

Este documento presenta una colección de consultas SQL orientadas a generar **resúmenes estadísticos y métricas clave** sobre el modelo relacional de la base de datos Jardinería. El objetivo es aplicar funciones agregadas y cláusulas de agrupamiento para obtener información consolidada que apoye la toma de decisiones comerciales.

## 📘 ¿Qué contiene este archivo?

- Consultas que utilizan funciones como `COUNT`, `SUM`, `AVG`, `MAX`, `MIN`.
- Agrupamientos por campos como país, estado, año, ciudad y producto.
- Cálculos de facturación, pagos, unidades vendidas y distribución de clientes.
- Ejercicios que permiten identificar tendencias, detectar oportunidades y evaluar el rendimiento comercial.

Cada consulta está numerada y estructurada con su código SQL, lista para ser ejecutada en entornos compatibles con MySQL o PostgreSQL.

## 🧩 Contexto del modelo

Las consultas se basan en el modelo relacional de la base de datos **Jardinería**, que incluye las siguientes entidades:

- `cliente`: información de clientes, país, ciudad y límite de crédito.
- `empleado`: datos de empleados, jefes y oficinas.
- `producto`: catálogo de productos, precios y gamas.
- `pedido` y `detalle_pedido`: pedidos realizados y sus productos.
- `pago`: transacciones realizadas por los clientes.

Este modelo permite realizar análisis agregados sobre ventas, pagos, cobertura geográfica, y desempeño por producto o empleado.

## 🎯 Propósito del ejercicio

El propósito de este archivo es:

- Dominar el uso de funciones agregadas y cláusulas `GROUP BY` y `HAVING`.
- Obtener métricas clave para dashboards y reportes ejecutivos.
- Preparar consultas reutilizables para visualización en Power BI.
- Consolidar buenas prácticas en SQL para análisis descriptivo y exploratorio.

## 📌 Consultas y Resoluciones

1. ¿Cuántos empleados hay en la compañía?
```sql
SELECT COUNT(*) AS total_empleados
FROM empleado;
```
<p align="center">
<img src="./imagenes/resumen 1.png" alt="resumen " width="200"/>

2. ¿Cuántos clientes tiene cada país?
```sql
SELECT pais, COUNT(*) AS total_clientes
FROM cliente
GROUP BY pais;
```
<p align="center">
<img src="./imagenes/resumen 2.png" alt="resumen " width="200"/>

3. ¿Cuál fue el pago medio en 2009?
```sql
SELECT AVG(total) AS pago_medio_2009
FROM pago
WHERE YEAR(fecha_pago) = 2009;
```
<p align="center">
<img src="./imagenes/resumen 3.png" alt="resumen " width="200"/>

4. ¿Cuántos pedidos hay en cada estado? Ordena el resultado de forma descendente por el número de pedidos.
```sql
SELECT estado, COUNT(*) AS total_pedidos
FROM pedido
GROUP BY estado
ORDER BY total_pedidos DESC;
```
<p align="center">
<img src="./imagenes/resumen 4.png" alt="resumen " width="200"/>

5. Calcula el precio de venta del producto más caro y más barato en una misma consulta.
```sql
SELECT MAX(precio_venta) AS precio_maximo,
       MIN(precio_venta) AS precio_minimo
FROM producto;
```
<p align="center">
<img src="./imagenes/resumen 5.png" alt="resumen " width="200"/>

6. Calcula el número de clientes que tiene la empresa.
```sql
SELECT COUNT(*) AS total_clientes
FROM cliente;
```
<p align="center">
<img src="./imagenes/resumen 6.png" alt="resumen " width="200"/>

7. ¿Cuántos clientes existen con domicilio en la ciudad de Madrid?
```sql
SELECT COUNT(*) AS clientes_en_madrid
FROM cliente
WHERE ciudad = 'Madrid';
```
<p align="center">
<img src="./imagenes/resumen 7.png" alt="resumen " width="200"/>

8. ¿Calcula cuántos clientes tiene cada una de las ciudades que empiezan por M?
```sql
SELECT ciudad, COUNT(*) AS total_clientes
FROM cliente
WHERE ciudad LIKE 'M%'
GROUP BY ciudad;
```
<p align="center">
<img src="./imagenes/resumen 8.png" alt="resumen " width="200"/>

9. Devuelve el nombre de los representantes de ventas y el número de clientes al que atiende cada uno.
```sql
SELECT e.nombre, e.apellido1, COUNT(c.codigo_cliente) AS clientes_asignados
FROM empleado e
JOIN cliente c ON e.codigo_empleado = c.codigo_empleado_rep_ventas
GROUP BY e.codigo_empleado;
```
<p align="center">
<img src="./imagenes/resumen 9.png" alt="resumen " width="200"/>

10. Calcula el número de clientes que no tiene asignado representante de ventas.
```sql
SELECT COUNT(*) AS clientes_sin_representante
FROM cliente
WHERE codigo_empleado_rep_ventas IS NULL;
```
<p align="center">
<img src="./imagenes/resumen 10.png" alt="resumen " width="200"/>

11. Calcula la fecha del primer y último pago realizado por cada uno de los clientes. El listado deberá mostrar el nombre y los apellidos de cada cliente.
```sql
SELECT c.nombre_cliente,
       MIN(p.fecha_pago) AS primer_pago,
       MAX(p.fecha_pago) AS ultimo_pago
FROM cliente c
JOIN pago p ON c.codigo_cliente = p.codigo_cliente
GROUP BY c.codigo_cliente;
```
<p align="center">
<img src="./imagenes/resumen 11.png" alt="resumen " width="200"/>

12. Calcula el número de productos diferentes que hay en cada uno de los pedidos.
```sql
SELECT codigo_pedido, COUNT(DISTINCT codigo_producto) AS productos_diferentes
FROM detalle_pedido
GROUP BY codigo_pedido;
```
<p align="center">
<img src="./imagenes/resumen 12.png" alt="resumen " width="200"/>

13. Calcula la suma de la cantidad total de todos los productos que aparecen en cada uno de los pedidos.
```sql
SELECT codigo_pedido, SUM(cantidad) AS total_unidades
FROM detalle_pedido
GROUP BY codigo_pedido;
```
<p align="center">
<img src="./imagenes/resumen 13.png" alt="resumen " width="200"/>

14. Devuelve un listado de los 20 productos más vendidos y el número total de unidades que se han vendido de cada uno. El listado deberá estar ordenado por el número total de unidades vendidas.
```sql
SELECT p.nombre, SUM(dp.cantidad) AS unidades_vendidas
FROM producto p
JOIN detalle_pedido dp ON p.codigo_producto = dp.codigo_producto
GROUP BY p.codigo_producto
ORDER BY unidades_vendidas DESC
LIMIT 20;
```
<p align="center">
<img src="./imagenes/resumen 14.png" alt="resumen " width="200"/>

15. La facturación que ha tenido la empresa en toda la historia, indicando la base imponible, el IVA y el total facturado. La base imponible se calcula sumando el coste del producto por el número de unidades vendidas de la tabla detalle_pedido. El IVA es el 21 % de la base imponible, y el total la suma de los dos campos anteriores.
```sql
SELECT 
    SUM(dp.cantidad * p.precio_proveedor) AS base_imponible,
    SUM(dp.cantidad * p.precio_proveedor) * 0.21 AS iva,
    SUM(dp.cantidad * p.precio_proveedor) * 1.21 AS total_facturado
FROM detalle_pedido dp
JOIN producto p ON dp.codigo_producto = p.codigo_producto;
```
<p align="center">
<img src="./imagenes/resumen 15.png" alt="resumen " width="200"/>

16. La misma información que en la pregunta anterior, pero agrupada por código de producto.
```sql
SELECT dp.codigo_producto,
       SUM(dp.cantidad * p.precio_proveedor) AS base_imponible,
       SUM(dp.cantidad * p.precio_proveedor) * 0.21 AS iva,
       SUM(dp.cantidad * p.precio_proveedor) * 1.21 AS total_facturado
FROM detalle_pedido dp
JOIN producto p ON dp.codigo_producto = p.codigo_producto
GROUP BY dp.codigo_producto;
```
<p align="center">
<img src="./imagenes/resumen 16.png" alt="resumen " width="200"/>

17. La misma información que en la pregunta anterior, pero agrupada por código de producto filtrada por los códigos que empiecen por OR.
```sql
SELECT dp.codigo_producto,
       SUM(dp.cantidad * p.precio_proveedor) AS base_imponible,
       SUM(dp.cantidad * p.precio_proveedor) * 0.21 AS iva,
       SUM(dp.cantidad * p.precio_proveedor) * 1.21 AS total_facturado
FROM detalle_pedido dp
JOIN producto p ON dp.codigo_producto = p.codigo_producto
WHERE dp.codigo_producto LIKE 'OR%'
GROUP BY dp.codigo_producto;
```
<p align="center">
<img src="./imagenes/resumen 17.png" alt="resumen " width="200"/>

18. Lista las ventas totales de los productos que hayan facturado más de 3000 euros. Se mostrará el nombre, unidades vendidas, total facturado y total facturado con impuestos (21% IVA).
```sql
SELECT p.nombre,
       SUM(dp.cantidad) AS unidades_vendidas,
       SUM(dp.cantidad * p.precio_proveedor) AS total_facturado,
       SUM(dp.cantidad * p.precio_proveedor) * 1.21 AS total_con_iva
FROM producto p
JOIN detalle_pedido dp ON p.codigo_producto = dp.codigo_producto
GROUP BY p.codigo_producto
HAVING total_facturado > 3000;
```
<p align="center">
<img src="./imagenes/resumen 18.png" alt="resumen " width="200"/>

19. Muestre la suma total de todos los pagos que se realizaron para cada uno de los años que aparecen en la tabla pagos.
```sql
SELECT YEAR(fecha_pago) AS año,
       SUM(total) AS total_pagado
FROM pago
GROUP BY YEAR(fecha_pago);
```
<p align="center">
<img src="./imagenes/resumen 19.png" alt="resumen " width="200"/>
